<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Mem√≥ria</title>

<!-- PWA -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ff6b6b">
<link rel="apple-touch-icon" href="icon-512.png">
<link rel="icon" href="icon-192.png">

<style>
  body {
    font-family: 'Arial', sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
    background: linear-gradient(to right, #ffd6a5, #fdffb6);
    overflow-x: hidden;
  }
  h1 {
    margin-top: 20px;
    color: #ff6b6b;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }
  .controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  #status {
    margin-top: 14px;
    font-size: 18px;
    font-weight: bold;
    color: #fff;
    background-color: #ff6b6b;
    display: inline-block;
    padding: 10px 16px;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  #game {
    display: grid;
    grid-template-columns: repeat(6, 100px);
    gap: 10px;
    justify-content: center;
    margin-top: 18px;
    padding-bottom: 40px;
  }
  .card {
    width: 100px;
    height: 100px;
    perspective: 1000px;
    cursor: pointer;
  }
  .card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
  }
  .card.flipped .card-inner {
    transform: rotateY(180deg);
  }
  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  .card-front {
    background: radial-gradient(circle at 30% 30%, #ffffff, #d9d9d9);
  }
  .card-back {
    transform: rotateY(180deg);
    background-color: #fff;
  }
  .card-back img {
    width: 90%;
    height: 90%;
    object-fit: cover;
    border-radius: 10px;
  }
  .card.matched .card-back {
    background-color: #8f8;
    box-shadow: 0 0 10px #4caf50;
  }
  button {
    padding: 10px 14px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    background: #ffffff;
  }
  button:hover {
    background-color: #ff6b6b;
    color: #fff;
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* Confete (canvas por cima de tudo) */
  #confetti {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 9999;
    display: none;
  }
</style>
</head>
<body>
<h1>Jogo da Mem√≥ria</h1>

<div class="controls">
  <button id="btnStart" onclick="startGame()">Come√ßar</button>
  <button id="btnRestart" onclick="restartGame()" disabled>Reiniciar</button>
</div>

<div id="status">Clique em ‚ÄúCome√ßar‚Äù</div>
<div id="game"></div>
<canvas id="confetti"></canvas>

<script>
let deck = [];
let flipped = [];
let matchedCount = 0;
let isLocked = true;

const images = [
  'images/foto1.jpg', 'images/foto2.jpg', 'images/foto3.jpg',
  'images/foto4.jpg', 'images/foto5.jpg', 'images/foto6.jpg',
  'images/foto7.jpg', 'images/foto8.jpg', 'images/foto9.jpg',
  'images/foto10.jpg', 'images/foto11.jpg', 'images/foto12.jpg'
];

// Sons
const soundMatch = new Audio('sounds/acerto.mp3');
const soundFail  = new Audio('sounds/erro.mp3');
const soundWin   = new Audio('sounds/parabens.mp3');

function setStatus(text) {
  document.getElementById('status').textContent = text;
}

function buildBoard() {
  const gameDiv = document.getElementById('game');
  gameDiv.innerHTML = '';

  deck.forEach((src) => {
    const card = document.createElement('div');
    card.classList.add('card');
    card.dataset.image = src;

    const inner = document.createElement('div');
    inner.classList.add('card-inner');

    const front = document.createElement('div');
    front.classList.add('card-front');

    const back = document.createElement('div');
    back.classList.add('card-back');

    const img = document.createElement('img');
    img.src = src;
    back.appendChild(img);

    inner.appendChild(front);
    inner.appendChild(back);
    card.appendChild(inner);

    card.addEventListener('click', () => flipCard(card));
    gameDiv.appendChild(card);
  });
}

function startGame() {
  stopConfetti();
  matchedCount = 0;
  flipped = [];
  isLocked = false;

  deck = images.concat(images);
  shuffle(deck);
  buildBoard();

  document.getElementById('btnStart').disabled = true;
  document.getElementById('btnRestart').disabled = false;
  setStatus('Encontre todos os pares!');
}

function restartGame() {
  startGame();
}

function flipCard(card) {
  if (isLocked) return;
  if (card.classList.contains('flipped') || card.classList.contains('matched')) return;

  card.classList.add('flipped');
  flipped.push(card);

  if (flipped.length === 2) {
    isLocked = true;
    setTimeout(checkMatch, 550);
  }
}

function checkMatch() {
  const [card1, card2] = flipped;

  if (card1.dataset.image === card2.dataset.image) {
    card1.classList.add('matched');
    card2.classList.add('matched');
    matchedCount += 2;
    soundMatch.play();

    if (matchedCount === deck.length) {
      soundWin.play();
      setStatus('üéâ Parab√©ns! Voc√™ terminou o jogo!');
      startConfetti(2200);
      isLocked = true;
      flipped = [];
      return;
    }

    setStatus('Boa! Continue!');
  } else {
    card1.classList.remove('flipped');
    card2.classList.remove('flipped');
    soundFail.play();
    setStatus('Tente de novo!');
  }

  flipped = [];
  isLocked = false;
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/* ==========================
   Confete (sem biblioteca)
   ========================== */
const confettiCanvas = document.getElementById('confetti');
const ctx = confettiCanvas.getContext('2d');
let confettiPieces = [];
let confettiAnim = null;
let confettiStopAt = 0;

function resizeConfetti() {
  const dpr = window.devicePixelRatio || 1;
  confettiCanvas.width = Math.floor(window.innerWidth * dpr);
  confettiCanvas.height = Math.floor(window.innerHeight * dpr);
  confettiCanvas.style.width = window.innerWidth + 'px';
  confettiCanvas.style.height = window.innerHeight + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener('resize', resizeConfetti);
resizeConfetti();

function rand(min, max) { return Math.random() * (max - min) + min; }

function makePiece() {
  const w = rand(6, 12);
  const h = rand(8, 16);
  return {
    x: rand(0, window.innerWidth),
    y: rand(-window.innerHeight, 0),
    w,
    h,
    vx: rand(-1.2, 1.2),
    vy: rand(2.2, 4.6),
    rot: rand(0, Math.PI * 2),
    vr: rand(-0.2, 0.2),
    // sem escolher cor manualmente? aqui √© s√≥ aleat√≥rio (OK)
    color: `hsl(${Math.floor(rand(0, 360))} 85% 60%)`,
    alpha: rand(0.85, 1)
  };
}

function startConfetti(durationMs = 2000) {
  resizeConfetti();
  confettiCanvas.style.display = 'block';

  confettiPieces = Array.from({ length: 140 }, makePiece);
  confettiStopAt = performance.now() + durationMs;

  if (confettiAnim) cancelAnimationFrame(confettiAnim);
  tickConfetti();
}

function stopConfetti() {
  if (confettiAnim) cancelAnimationFrame(confettiAnim);
  confettiAnim = null;
  confettiPieces = [];
  ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
  confettiCanvas.style.display = 'none';
}

function tickConfetti() {
  const now = performance.now();
  ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

  for (const p of confettiPieces) {
    p.x += p.vx;
    p.y += p.vy;
    p.rot += p.vr;

    // leve "vento"
    p.vx += rand(-0.03, 0.03);
    p.vx = Math.max(-2, Math.min(2, p.vx));

    // reaparece se saiu
    if (p.y > window.innerHeight + 30) {
      p.y = rand(-120, -20);
      p.x = rand(0, window.innerWidth);
      p.vy = rand(2.2, 4.8);
    }

    ctx.save();
    ctx.globalAlpha = p.alpha;
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rot);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
    ctx.restore();
  }

  if (now < confettiStopAt) {
    confettiAnim = requestAnimationFrame(tickConfetti);
  } else {
    stopConfetti();
  }
}
</script>

<!-- Registrar Service Worker -->
<script src="pwa.js"></script>

</body>
</html>

